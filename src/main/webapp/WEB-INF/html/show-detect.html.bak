<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>人脸检查</title>

    <style>
        .border {
            border: 1px red solid;

        }
        .imgbox{
            zoom: 1;
            padding: 0px;
            margin: 0px;
            width: 400px;
            height: 400px;
            background-color: #e4e4e4;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
    </style>
    <link rel="stylesheet" href="../css/swiper.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <script src="../js/lib/jquery-1.10.2.min.js"></script>
    <script src="../js/lib/bootstrap.min.js"></script>
    <!--<script src="../js/swiper-3.4.2.min.js"></script>-->
</head>
<body>
<div class="container">
    <div class="row-fluid">
        <div class="col-xs-5 border">
            <form id="picForm">
                <!--<input id="picShow" type="image" src="../images/pic.jpg">-->
                <div id="picShow" class="imgbox">
                    <!--<input type="image" src="https://bj-mc-prod-asset.oss-cn-beijing.aliyuncs.com/mc-official/images/demo/demo-pic1.jpg">-->
                    <img id="imgShow" width="400px" height="400px"  src="http://192.168.10.212:8080/images/1.jpg">
                </div>
            </form>
            <div class="row">
                <div class="col-sm-6 col-md-3">
                    <a href="#" id="img1" class="thumbnail">
                        <img src="http://192.168.10.212:8080/images/1.jpg"
                             alt="demo" onclick="detectReq(this)">
                    </a>
                </div>
                <div class="col-sm-6 col-md-3">
                    <a href="#" id="img2" class="thumbnail">
                        <img src="http://192.168.10.212:8080/images/2.jpg"
                             alt="demo" onclick="detectReq(this)">
                    </a>
                </div>
                <div class="col-sm-6 col-md-3">
                    <a href="#" class="thumbnail">
                        <img src="http://192.168.10.212:8080/images/3.jpg"
                             alt="demo" onclick="detectReq(this)">
                    </a>
                </div>
                <div class="col-sm-6 col-md-3">
                    <a href="#" class="thumbnail">
                        <img src="http://192.168.10.212:8080/images/4.jpg"
                             alt="demo" onclick="detectReq(this)">
                    </a>
                </div>
                <div class="col-sm-6 col-md-3">
                    <a href="#" class="thumbnail">
                        <img src="http://192.168.10.212:8080/images/timg1.jpg"
                             alt="demo" onclick="detectReq(this)">
                    </a>
                </div>
                    <!--<input type="file" class="btn btn-primary" id="" onchange="uploadPic(this)" name="uploadFile">-->
                    <!--<lable for="file-uploader" class="upload-img"><i class="icons icon-upload"></i><span>本地上传</span>-->
                        <!--<input type="file" accept="image/png,image/jpeg" id="file-uploader">-->
                    <!--</lable>-->
                <form id="jvForm"  method="post" enctype="multipart/form-data">
                    <!--<img width="100" height="100" id="allImgUrl"/>-->
                    <input type="file" id="uploadImg"  onchange="uploadPic(this)" name="photo"/>

                </form>

            </div>
        </div>
        <div class="col-xs-1 border"></div>
        <div class="col-xs-5 border">
            <!--<form id="picForms">-->
                <!--&lt;!&ndash;<input id="picShow" type="image" src="../images/pic.jpg">&ndash;&gt;-->
                <!--<div></div>-->
                <!--<input type="image" src="../images/pic.jpg">-->

            <!--</form>-->
            <!--<form id="jvForm" action="o_save.shtml" method="post" enctype="multipart/form-data">-->
                    <!--<img width="100" height="100" id="allImgUrl"/>-->
                    <!--<input type="file" id="uploadImg"  onchange="uploadPic()" name="photo"/>-->

            <!--</form>-->


            <div style="border:2px dashed red;">
                <p>
                    图片上传前预览：<input type="file" id="xdaTanFileImg" onchange="xmTanUploadImg(this)" />

                    <!--<input type="button" value="隐藏图片" onclick="document.getElementById('xmTanImg').style.display = 'none';"/>-->
                    <!--<input type="button" value="显示图片" onclick="document.getElementById('xmTanImg').style.display = 'block';"/>-->
                </p>
                <img id="xmTanImg"/>
                <!--<div id="xmTanDiv"></div>-->
            </div>
            <hr />

        </div>
    </div>
    <script>
//        //判断浏览器是否支持FileReader接口
//        if (typeof FileReader == 'undefined') {
//            document.getElementById("xmTanDiv").InnerHTML = "<h1>当前浏览器不支持FileReader接口</h1>";
//            //使选择控件不可操作
//            document.getElementById("xdaTanFileImg").setAttribute("disabled", "disabled");
//        }

//        //选择图片，马上预览
        function xmTanUploadImg(obj) {
            var file = obj.files[0];

            console.log(obj);console.log(file);
            console.log("file.size = " + file.size);  //file.size 单位为byte

            var reader = new FileReader();

//            //读取文件过程方法
//            reader.onloadstart = function (e) {
//                console.log("开始读取....");
//            }
//            reader.onprogress = function (e) {
//                console.log("正在读取中....");
//            }
//            reader.onabort = function (e) {
//                console.log("中断读取....");
//            }
//            reader.onerror = function (e) {
//                console.log("读取异常....");
//            }
            reader.onload = function (e) {
                console.log("成功读取....");

                var img = document.getElementById("xmTanImg");
                img.src = e.target.result;
                //或者 img.src = this.result;  //e.target == this
            }

            reader.readAsDataURL(file)
        }

        function uploadPic(obj){
            var img = document.getElementById("imgShow");
            var file = obj.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                console.log("成功读取....");

//                var img = $("#imgShow");

                img.src = e.target.result;
                //或者 img.src = this.result;  //e.target == this
            }
            reader.readAsDataURL(file)
            var options = {
                url:"../n-tech/v0/detect",
                type:"post",
                dataType:"json",
//                data: {photo: img.src},
                success:function(data){
//                    alert("success"+data)
                    console.log(data+"fasdfasdfasdfasdfsadf")
                    handleData(img,data)
                    //回调两个路径
                    //url
//                    $("#allImgUrl").attr("src", $('#uploadImg').value);
                    //path
//                    $("#path").val(data.path);
                },
                error:function (data) {
                  alert(data+"出现错误")
                }
            };
            //jquery.form使用方式
            $("#jvForm").ajaxSubmit(options);



        }
        $(document).ready(function () {



//            $("#img").click(function () {
//                $('#imgShow').src=$('#img'+i).attr("src")
//                console.log()
////            var formData = new FormData();
////            formData.append("file",document.getElementById("picForm"))
//
//
//            });
        }); //ready
        var num=0;
        function detectReq(img) {
//            for (var i = 0; i < num; i++) {
//                if ($('#' + i).length > 0) {
//                    $('#' + i).remove();
//                }
//            }
//            console.log("width:"+img.naturalWidth)
//            console.log("height:"+img.naturalHeight)
//            if(img.naturalWidth>400){
//                var widthRate=400/img.naturalWidth
//            }
//            if(img.naturalHeight>400){
//                var heightRate=400/img.naturalHeight
//            }
//            $('#imgShow').attr("src",img.src);
            $.ajax({
                url: '../n-tech/v0/detect',
                type: 'POST',
//                    data: {photo: address},
                dataType:"json",
                data: {photo: img.src},
                async: true,
//                dataType : 'json',
                success: function (data) {
                    handleData(img,data)

                }
            });
        }
        function handleData(img,data) {
            for (var i = 0; i < num; i++) {
                if ($('#' + i).length > 0) {
                    $('#' + i).remove();
                }
            }
            console.log("width:"+img.naturalWidth)
            console.log("height:"+img.naturalHeight)
            if(img.naturalWidth>400){
                var widthRate=400/img.naturalWidth
            }
            if(img.naturalHeight>400){
                var heightRate=400/img.naturalHeight
            }
            $('#imgShow').attr("src",img.src);
            console.log(data);
//            var dataObj = eval("(" + data + ")");
//            var dataObj=JSON.parse(data)
            var dataObj=eval(data)

            var rect;
            var results = [];
            if (dataObj.hasOwnProperty("faces")) {
                rect = dataObj['faces'];
                for (var i = 0; i < rect.length; i++) {
                    if(widthRate){
                        rect[i].x1=rect[i].x1 *widthRate
                        rect[i].x2=rect[i].x2 *widthRate
                    }
                    if(heightRate){
                        rect[i].y1=rect[i].y1 *heightRate
                        rect[i].y2=rect[i].y2 *heightRate
                    }
                    width = rect[i].x2 - rect[i].x1 - 8
                    height = rect[i].y2 - rect[i].y1 - 6
                    left = rect[i].x1 + 18
                    divtop = rect[i].y1 + 6
                    var result= new Result(width,height,left,divtop);
                    results[i] = result;
                    console.log(results);
                }
            }
            if (results) {

                for (var i = 0; i < num; i++) {
                    if ($('#' + i).length > 0) {
                        $('#' + i).remove();
                    }
                }
                num=results.length;
                for (var i = 0; i < results.length; i++) {
                    $('#picShow').prepend("<div id="+i+"></div>");
                    $('#' + i).css({
                        "position": "absolute",
                        "outline": "rgb(70, 171, 232) solid 2px",
                        "width": results[i].width,
                        "height": results[i].height,
                        "left": results[i].left,
                        "top": results[i].top
                    })
                }

            }
        }
        function Result(width,height,left,top) {
            this.width=width;
            this.height=height;
            this.left=left;
            this.top=top;
        }
//
//        $("#img1").click(function () {
//            // alert($("#img1").attr("src"));
//            address="";
//            //更换图片的url，得以切换图片
//            $("#image").attr("src",$("#img1").attr("src"));
//            address=$("#img1").attr("src");
//        });
//        $("#img2").click(function () {
//            address="";
//            $("#image").attr("src",$("#img2").attr("src"));
//            address=$("#img2").attr("src");
//        });
//        $("#img3").click(function () {
//            address="";
//            $("#image").attr("src",$("#img3").attr("src"));
//            address=$("#img3").attr("src");
//        });
//        $("#img4").click(function () {
//
//            $("#image").attr("src",$("#img4").attr("src"));
//            address=$("#img4").attr("src");
//        });
//        $("#check").click(function () {
//            address="";
//            var imgUrl=$("#imageUrl").val();
//
//            $("#image").attr("src",imgUrl);
//            address=imgUrl;
//        });
    </script>
</div>
<script src="../js/lib/jquery.form.js"></script>
<script>

</script>
</body>

</html>